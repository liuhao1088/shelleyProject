<authorize id="authorize" />
<wxs src="../../utils/util.wxs" module="utils" />
<view class="groupSpecialContainer">
  <!-- 头部 -->
  <view class="wrap">
    <view class="header-imgItem">
      <image src="https://img14.360buyimg.com/ddimg/jfs/t1/159173/33/2146/40556/5ff6c4d8Ece21510a/6d45385c83c62f3d.png"
        mode="widthFix"></image>
    </view>
    <view class="group-countdownItem">
      <view class="group-titleItem">特惠拼团</view>
      <view class="countdown-item">
        <view class="wrap-title"><text wx:if="{{action=='finish'}}">活动已结束</text>
          <text wx:else>{{action=='going'?'活动结束倒计时':'活动开始倒计时'}}</text>：
          <text class='tui-conutdown-box'>{{days}}</text>天
          <text class='tui-conutdown-box'>{{hours}}</text>时
          <text class='tui-conutdown-box'>{{minutes}}</text>分
          <text class='tui-conutdown-box tui-countdown-bg'>{{seconds}}</text>秒
        </view>
      </view>
    </view>
    <view class="group-mainItem"></view>
  </view>
  <view class="group-main">
    <view class="coupon-item" wx:for="{{data.shopping}}" data-index="{{index}}" wx:for-item="shopping" wx:key="id">
      <view class="coupon-imgItem">
        <image src="{{shopping.link}}" style="border-radius: 10rpx;"></image>
      </view>
      <view class="coupon-mainItem">
        <view class="coupon-titleItem">
          <view class="coupon-title">{{shopping.name}}</view>
          <view class="coupon-address">{{data.shop[0].shop_name}}专用</view>
        </view>

        <view class="coupon-swiper" wx:if="{{shopping.status!==true&&action=='going'}}">
          <swiper class="top_swiper" circular vertical interval="2000" bindchange="getIndex" autoplay>
            <swiper-item wx:for="{{shopping.userList}}" wx:key="id" style="display: flex;">
              <view class="coupon-main">
                <view class="coupon-wrap">
                  <view class="coupon-user">
                    <view class="swiper-img align-center">
                      <image class="swiper-img" src="{{item.image}}"></image>
                    </view>
                    <view class="swiper-name">{{utils.substr(item.name)}}</view>
                    <view class="coupon-msg">还差 <text style="color: red;">1</text> 人拼成</view>
                  </view>

                  <view class="coupon-time">剩余时间：{{item.surplus}} 分钟</view>
                </view>
              </view>
            </swiper-item>
          </swiper>
        </view>
        <view class="coupon-swiper" wx:if="{{shopping.status==true}}">
          <view class="coupon-main">
            <view class="coupon-wrap">
              <view class="coupon-user">
                <view class="swiper-img align-center">
                  <image class="swiper-img" src="{{userInfo.avatarUrl}}"></image>
                </view>
                <view class="swiper-name">{{userInfo.nickName}}</view>
              </view>
              <view class="coupon-time">您已经领取过该优惠券</view>
            </view>
          </view>
        </view>
        <view class="coupon-swiper" wx:if="{{action!=='going'&&shopping.status!==true}}">
          <view class="coupon-main">
            <view class="coupon-wrap">
              <view class="coupon-user">
                <view class="swiper-img align-center">
                  <image class="swiper-img" src="{{userInfo.avatarUrl}}"></image>
                </view>
                <view class="swiper-name" wx:if="{{userInfo.nickName}}">{{userInfo.nickName}}</view>
                <view class="swiper-name" wx:else>{{action=='finish'?'活动到期':'活动未开始'}}</view>
              </view>
              <view class="coupon-time">{{action=='finish'?'活动到期':'活动未开始'}}</view>
            </view>
          </view>
        </view>
    
        

        <view class="coupon-priceItem">
          <view class="coupon-price">拼团价：<text class="group-price">￥{{shopping.price}}</text> <text
              style=" margin-left: 10rpx;text-decoration:line-through;">￥{{shopping.original_price}}</text></view>
          <view class="coupon-butItem">
            <view class="group-butItem" style="margin-right: 20rpx;">
              <button class="but-group" bindtap="showModal" data-index="{{index}}" data-target="goGroup">去拼团</button>
            </view>
            <view class="group-butItem" bindtap="launchGroup" data-index="{{index}}">
              <button class="but-initiate" >发起拼团</button>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>


  <!-- <view class="title"><text bindtap="toActivityRule">活动规则</text> </view>
  <view class="wrap">
    <view class="wrap-title">拼团特惠</view>

    <view class="wrap-title" style="font-size: 24rpx;margin-top: 20rpx;"><text wx:if="{{action=='finish'}}">活动已结束</text>
      <text wx:else>{{action=='going'?'活动结束倒计时':'活动开始倒计时'}}</text>：
      <text class='tui-conutdown-box'>{{days}}</text>天
      <text class='tui-conutdown-box'>{{hours}}</text>时
      <text class='tui-conutdown-box'>{{minutes}}</text>分
      <text class='tui-conutdown-box tui-countdown-bg'>{{seconds}}</text>秒
    </view>

    <view class="coupon-item" wx:for="{{data.shopping}}" data-index="{{index}}" wx:for-item="shopping" wx:key="id">
      <view class="img-item align-center">
        <image style="height:190rpx;width:180rpx;" src="{{shopping.link}}" />
      </view>

      <view class="wrap-item">
        <view class="coupon-titleItem">
          <text class="coupon-title">{{shopping.name}}</text>
          <text class="coupon-address">{{data.shop[0].shop_name}}专用</text>
        </view>

        <view class="coupon-group" wx:if="{{shopping.status==true}}">
          <swiper class="top_swiper">
            <swiper-item style="display: flex;">
              <view class="coupon-main">
                <view class="coupon-wrap">
                  <view class="coupon-user">
                    <view class="swiper-img">
                      <image src="{{userInfo.avatarUrl}}"></image>
                    </view>
                    <view class="swiper-name">{{userInfo.nickName}}</view>
                  </view>
                  <view class="coupon-msg"> <text style="color: red;"></text> </view>
                </view>
                <view class="coupon-wrap" style="padding-top: 6rpx;">您已经领取过该优惠券</view>
              </view>
              <view class="coupon-but">
                <button class="but" bindtap="toMyCoupon">去查看</button>
              </view>
            </swiper-item>
          </swiper>
        </view>
        <view class="coupon-group" wx:if="{{action!=='going'&&shopping.status!==true}}">
          <swiper class="top_swiper">
            <swiper-item style="display: flex;">
              <view class="coupon-main">
                <view class="coupon-wrap">
                  <view class="coupon-user">
                    <view class="swiper-img">
                      <image src="{{userInfo.avatarUrl}}" style="background-color:gray;"></image>
                    </view>
                    <view class="swiper-name" wx:if="{{userInfo.nickName}}">{{userInfo.nickName}}</view>
                    <view class="swiper-name" wx:else>{{action=='finish'?'活动到期':'活动未开始'}}</view>
                  </view>
                  <view class="coupon-msg"> <text style="color: red;"></text> </view>
                </view>
                <view class="coupon-wrap" style="padding-top: 6rpx;">{{action=='finish'?'活动已经结束，下次再来！':'活动还未开始，敬请期待！'}}</view>
              </view>
              <view class="coupon-but">
                <button class="but" bindtap="toMyCoupon">去查看</button>
              </view>
            </swiper-item>
          </swiper>
        </view>
        <view class="coupon-group" wx:if="{{shopping.status!==true&&action=='going'}}" data-index="{{index}}" bindtap="showModal" data-target="goGroup">
          <swiper class="top_swiper" circular vertical interval="2000" autoplay>
            <swiper-item wx:for="{{shopping.userList}}" wx:key="id" style="display: flex;">
              <view class="coupon-main">
                <view class="coupon-wrap">
                  <view class="coupon-user">
                    <view class="swiper-img">
                      <image class="swiper-img" src="{{item.image}}"></image>
                    </view>
                    <view class="swiper-name">{{item.name}}</view>
                  </view>
                  <view class="coupon-msg">还差 <text style="color: red;">1</text> 人拼成</view>
                </view>
                <view class="coupon-wrap" style="padding-top: 6rpx;">剩余时间：{{item.surplus}} 分钟</view>
              </view>
              <view class="coupon-but" bindtap="getIndex" data-index="{{index}}">
                <button class="but">去拼团</button>
              </view>
            </swiper-item>
          </swiper>
        </view>


        <view class="coupon-group">
          <view class="coupon-main">
            <view class="group-price">¥ {{shopping.price}}</view>
            <view class="price-item">原价：¥ {{shopping.original_price}}</view>
          </view>
          <view class="coupon-but" wx:if="{{shopping.status!==true&&action=='going'}}">
            <button class="but" style="background-color: rgba(255, 255, 255, 100);color: rgba(105, 113, 254, 100);border: 2rpx solid rgba(105, 113, 254, 100);padding: 0;"
             data-index="{{index}}" bindtap="launchGroup" data-target="initiateGroup">发起拼团</button>
          </view>
        </view>
      </view>
    </view>

  </view> -->
</view>

<!-- 去拼团弹窗 -->
<view class="cu-modal {{modalName=='goGroupSuccess'?'show':''}}" catchtouchmove="ture">
  <view class="cu-dialog">
    <view class="cu-bar bg-white justify-end">
      <view class="content"></view>
      <view class="action" bindtap="hideModal">
        <text class="cuIcon-close text-gray"></text>
      </view>
    </view>
    <view class="padding-xl">
      <view class="icon-item">
        <text class="iconfont iconCheck" style="font-size: 120rpx;background-color: rgb(229, 7, 34, 0.5);"></text>
      </view>
      <view class="modal-item">仅剩<text
          style="color:red;">{{data.shopping[waresInd].people-1}}</text>个席位，{{data.shopping[waresInd].time}}分钟后结束，赶快邀请好友来拼团吧！~
      </view>
      <view class="modal-but">
        <view class="but-item">
          <button class="turn-but" bindtap="toMyCoupon">查看拼团券</button>
        </view>
        <view class="but-item">
          <button class="share-but" open-type='share'>分享给好友</button>
        </view>
      </view>
    </view>
  </view>
</view>

<!--去拼团弹窗  -->
<view class="cu-modal {{modalName=='goGroup'?'show':''}}" style="z-index:10;" catchtouchmove="ture">
  <view class="cu-dialog">
    <view class="cu-bar bg-white justify-end">
      <view class="content"></view>
      <view class="action" bindtap="hideModal">
        <text class="cuIcon-close text-gray"></text>
      </view>
    </view>
    <view class="padding-xl">
      <view class="modal-title">参与{{transfer?sponsor.nickName:data.shopping[waresInd].userList[userInd].anonymous}}的拼团
      </view>
      <view class="modal-item" style="margin-top: 20rpx;">仅剩<text
          style="color:red;">{{transfer?surplusperson:1}}</text>个席位，{{transfer?surplustime:data.shopping[waresInd].userList[userInd].surplus}}分钟后结束
      </view>
      <view class="modal-userItem">
        <view class="fight-master">
          <image src="{{transfer?sponsor.avatarUrl:data.shopping[waresInd].userList[userInd].image}}" style=""></image>
          <view class="user-item">拼主</view>
        </view>
        <view class="modal-box" wx:if="{{avatarUrl==''}}">
          <text class="iconfont iconwenhao" style="font-size: 50rpx;"></text>
          <image else src="{{avatarUrl}}" class="iconfont iconwenhao" style="font-size: 50rpx;" />
        </view>
        <image else src="{{avatarUrl}}" class=""
          style="font-size:50rpx;height:120rpx;width:120rpx;line-height:120rpx;border-radius: 50%;display:{{avatarUrl==''?'none':'flex'}}" />
      </view>
      <view class="join-but">
        <button bindtap="joinGroup" data-target="goGroupSuccess">加入拼团</button>
      </view>
    </view>
  </view>

</view>

<!-- 发起拼团成功弹窗 -->
<view class="cu-modal {{modalName=='initiateGroup'?'show':''}}" catchtouchmove="ture">
  <view class="cu-dialog">
    <view class="cu-bar bg-white justify-end">
      <view class="content"></view>
      <view class="action" bindtap="hideModal">
        <text class="cuIcon-close text-gray"></text>
      </view>
    </view>
    <view class="padding-xl">
      <view class="icon-item">
        <text class="iconfont iconqueren" style="font-size: 120rpx;"></text>
      </view>
      <view class="modal-title">拼团成功</view>
      <view class="modal-msg">拼团券领取成功,邀请好友，享受更多福利</view>
      <view class="modal-but">
        <view class="but-item">
          <button class="turn-but" bindtap="toMyCoupon">去使用</button>
        </view>
        <view class="but-item">
          <!-- <button class="share-but" style="font-size: 24rpx;" bindtap="toReserveStore">查看可用门店</button> -->
          <button class="share-but" bindtap="showModal" data-target="question">再减100元</button>
        </view>
      </view>
    </view>
  </view>
</view>

<!-- 问答 -->
<view class="cu-modal {{modalName=='question'?'show':''}}" catchtouchmove="ture">
  <view class="cu-dialog">
    <view class="cu-bar bg-white justify-end">
      <view class="content"></view>
      <view class="action" bindtap="hideModal">
        <text class="cuIcon-close text-gray"></text>
      </view>
    </view>
    <view class="padding-xl">
      <view class="modal-img">
        <view class="title-item">选择回答立领100元现金抵扣红包</view>
        <view class="tag-item">您是否有安装以下汽车配件？</view>
      </view>
      <view class="modal-wrap">
        <view class="modal-selectBut" wx:for="{{checkbox}}" wx:key="id">
          <button style="{{item.checked?'background-color: rgba(104, 112, 253, 50);':''}}" bindtap="ChooseCheckbox"
            id="{{item.id}}">{{item.name}}</button>
        </view>
      </view>
      <view class="modal-questionBut">
        <button>立即领取并使用</button>
      </view>
    </view>
  </view>
</view>